<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>深入剖析Java中的装箱和拆箱 | Andone1cc</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="深入剖析Java中的装箱和拆箱自动装箱和拆箱问题是Java中一个老生常谈的问题了，今天我们就来一些看一下装箱和拆箱中的若干问题。本文先讲述装箱和拆箱最基本的东西，再来看一下面试笔试中经常遇到的与装箱、拆箱相关的问题。">
<meta property="og:type" content="article">
<meta property="og:title" content="深入剖析Java中的装箱和拆箱">
<meta property="og:url" content="http://yoursite.com/2016/11/06/java基础/拆箱和装箱/index.html">
<meta property="og:site_name" content="Andone1cc">
<meta property="og:description" content="深入剖析Java中的装箱和拆箱自动装箱和拆箱问题是Java中一个老生常谈的问题了，今天我们就来一些看一下装箱和拆箱中的若干问题。本文先讲述装箱和拆箱最基本的东西，再来看一下面试笔试中经常遇到的与装箱、拆箱相关的问题。">
<meta property="og:image" content="http://images.cnitblog.com/i/288799/201406/101641567956500.jpg">
<meta property="og:updated_time" content="2016-11-06T14:32:28.825Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="深入剖析Java中的装箱和拆箱">
<meta name="twitter:description" content="深入剖析Java中的装箱和拆箱自动装箱和拆箱问题是Java中一个老生常谈的问题了，今天我们就来一些看一下装箱和拆箱中的若干问题。本文先讲述装箱和拆箱最基本的东西，再来看一下面试笔试中经常遇到的与装箱、拆箱相关的问题。">
<meta name="twitter:image" content="http://images.cnitblog.com/i/288799/201406/101641567956500.jpg">
  
    <link rel="alternate" href="/atom.xml" title="Andone1cc" type="application/atom+xml">
  
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" integrity="sha384-XdYbMnZ/QjLh6iI4ogqCTaIjrFk87ip+ekIjefZch0Y+PvJ8CDYtEs1ipDmPorQ+" crossorigin="anonymous">

  <link rel="stylesheet" href="/css/styles.css">
  

</head>

<body>
  <nav class="navbar navbar-inverse">
  <div class="container">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#main-menu-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="main-menu-navbar">
      <ul class="nav navbar-nav">
        
          <li><a class=""
                 href="/index.html">Home</a></li>
        
          <li><a class=""
                 href="/archives/">Archives</a></li>
        
      </ul>

      <!--
      <ul class="nav navbar-nav navbar-right">
        
          <li><a href="/atom.xml" title="RSS Feed"><i class="fa fa-rss"></i></a></li>
        
      </ul>
      -->
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>

  <div class="container">
    <div class="blog-header">
  <h1 class="blog-title">Andone1cc</h1>
  
    <p class="lead blog-description">一个有梦想的CS小白</p>
  
</div>

    <div class="row">
        <div class="col-sm-8 blog-main">
          <article id="post-java基础/拆箱和装箱" class="article article-type-post" itemscope itemprop="blogPost">

  <header class="article-header">
    
  
    <h1 class="article-title" itemprop="name">
      深入剖析Java中的装箱和拆箱
    </h1>
  


  </header>

  <div class="article-meta">
    <div class="article-datetime">
  <a href="/2016/11/06/java基础/拆箱和装箱/" class="article-date"><time datetime="2016-11-06T14:17:46.546Z" itemprop="datePublished">2016-11-06</time></a>
</div>

    
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/JAVA/">JAVA</a>
  </div>


  </div>
  <div class="article-inner">

    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="深入剖析Java中的装箱和拆箱"><a href="#深入剖析Java中的装箱和拆箱" class="headerlink" title="深入剖析Java中的装箱和拆箱"></a>深入剖析Java中的装箱和拆箱</h3><p>自动装箱和拆箱问题是Java中一个老生常谈的问题了，今天我们就来一些看一下装箱和拆箱中的若干问题。本文先讲述装箱和拆箱最基本的东西，再来看一下面试笔试中经常遇到的与装箱、拆箱相关的问题。</p>
<a id="more"></a>
<h3 id="一-什么是装箱？什么是拆箱？"><a href="#一-什么是装箱？什么是拆箱？" class="headerlink" title="一.什么是装箱？什么是拆箱？"></a>一.什么是装箱？什么是拆箱？</h3><p>前面的文章中提到，Java为每种基本数据类型都提供了对应的包装器类型，至于为什么会为每种基本数据类型提供包装器类型在此不进行阐述，有兴趣的朋友可以查阅相关资料。在Java SE5之前，如果要生成一个数值为10的Integer对象，必须这样进行：</p>
<pre><code>`Integer i = new Integer(10);`
</code></pre><p>而在从Java SE5开始就提供了自动装箱的特性，如果要生成一个数值为10的Integer对象，只需要这样就可以了：</p>
<pre><code>`Integer i = 10;`
</code></pre><p>这个过程中会自动根据数值创建对应的 Integer对象，这就是装箱。</p>
<p>那什么是拆箱呢？顾名思义，跟装箱对应，就是<code>自动将包装器类型转换为基本数据类型</code>：</p>
<pre><code>`Integer i = 10;  //装箱
 int n = i;   //拆箱`
</code></pre><p>简单一点说，装箱就是  自动将基本数据类型转换为包装器类型；拆箱就是  自动将包装器类型转换为基本数据类型。</p>
<p>下表是基本数据类型对应的包装器类型：</p>
<table>
<thead>
<tr>
<th style="text-align:left">基本类型</th>
<th style="text-align:center">包装类型</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">int（4字节）</td>
<td style="text-align:center">Integer</td>
</tr>
<tr>
<td style="text-align:left">byte（1字节）</td>
<td style="text-align:center">Byte</td>
</tr>
<tr>
<td style="text-align:left">short（2字节）</td>
<td style="text-align:center">Short</td>
</tr>
<tr>
<td style="text-align:left">long（8字节）</td>
<td style="text-align:center">Long</td>
</tr>
<tr>
<td style="text-align:left">float（4字节）</td>
<td style="text-align:center">Float</td>
</tr>
<tr>
<td style="text-align:left">double（8字节）</td>
<td style="text-align:center">Double</td>
</tr>
<tr>
<td style="text-align:left">char（2字节）</td>
<td style="text-align:center">Character</td>
</tr>
<tr>
<td style="text-align:left">boolean（未定）</td>
<td style="text-align:center">Boolean</td>
</tr>
</tbody>
</table>
<h3 id="二、装箱和拆箱是如何实现的"><a href="#二、装箱和拆箱是如何实现的" class="headerlink" title="二、装箱和拆箱是如何实现的"></a>二、装箱和拆箱是如何实现的</h3><p>上一小节了解装箱的基本概念之后，这一小节来了解一下装箱和拆箱是如何实现的。</p>
<p>我们就以Interger类为例，下面看一段代码：</p>
<pre><code>`public class Main {
    public static void main(String[] args) {

        Integer i = 10;
        int n = i;
    }
}`
</code></pre><p>反编译class文件之后得到如下内容：</p>
<p><img src="http://images.cnitblog.com/i/288799/201406/101641567956500.jpg" alt=""></p>
<p>从反编译得到的字节码内容可以看出，在装箱的时候自动调用的是Integer的valueOf(int)方法。而在拆箱的时候自动调用的是Integer的intValue方法。</p>
<p>其他的也类似，比如Double、Character，不相信的朋友可以自己手动尝试一下。</p>
<p>因此可以用一句话总结装箱和拆箱的实现过程：</p>
<p>装箱过程是通过调用包装器的valueOf方法实现的，而拆箱过程是通过调用包装器的 xxxValue方法实现的。（xxx代表对应的基本数据类型）。</p>
<h3 id="三、面试中相关的问题"><a href="#三、面试中相关的问题" class="headerlink" title="三、面试中相关的问题"></a>三、面试中相关的问题</h3><p>虽然大多数人对装箱和拆箱的概念都清楚，但是在面试和笔试中遇到了与装箱和拆箱的问题却不一定会答得上来。下面列举一些常见的与装箱/拆箱有关的面试题。</p>
<p>1.下面这段代码的输出结果是什么？</p>
<pre><code>`public class Main {
    public static void main(String[] args) {

        Integer i1 = 100;
        Integer i2 = 100;
        Integer i3 = 200;
           Integer i4 = 200;

        System.out.println(i1==i2);
        System.out.println(i3==i4);
    }
}`
</code></pre><p>也许有些朋友会说都会输出false，或者也有朋友会说都会输出true。但是事实上输出结果是：</p>
<pre><code>`true`
`false`
</code></pre><p>为什么会出现这样的结果？输出结果表明i1和i2指向的是同一个对象，而i3和i4指向的是不同的对象。此时只需一看源码便知究竟，下面这段代码是Integer的valueOf方法的具体实现：</p>
<pre><code>`public static Integer valueOf(int i) {
    if(i &gt;= -128 &amp;&amp; i &lt;= IntegerCache.high)
        return IntegerCache.cache[i + 128];
    else
        return new Integer(i);
}`
</code></pre><p>而其中IntegerCache类的实现为：</p>
<pre><code>`private static class IntegerCache {
    static final int high;
    static final Integer cache[];

    static {
        final int low = -128;

        // high value may be configured by property
        int h = 127;
        if (integerCacheHighPropValue != null) {
            // Use Long.decode here to avoid invoking methods that
            // require Integer&apos;s autoboxing cache to be initialized
            int i = Long.decode(integerCacheHighPropValue).intValue();
            i = Math.max(i, 127);
            // Maximum array size is Integer.MAX_VALUE
            h = Math.min(i, Integer.MAX_VALUE - -low);
        }
        high = h;

        cache = new Integer[(high - low) + 1];
        int j = low;
        for(int k = 0; k &lt; cache.length; k++)
            cache[k] = new Integer(j++);
    }

    private IntegerCache() {}
}`
</code></pre><p>2.下面这段代码的输出结果是什么？</p>
<pre><code>`public class Main {
    public static void main(String[] args) {

        Double i1 = 100.0;
        Double i2 = 100.0;
        Double i3 = 200.0;
        Double i4 = 200.0;

        System.out.println(i1==i2);
        System.out.println(i3==i4);
    }
}`
</code></pre><p>也许有的朋友会认为跟上面一道题目的输出结果相同，但是事实上却不是。实际输出结果为：</p>
<pre><code>`false`
`false`
</code></pre><p>至于具体为什么，读者可以去查看Double类的valueOf的实现。</p>
<p>在这里只解释一下为什么Double类的valueOf方法会采用与Integer类的valueOf方法不同的实现。很简单：在某个范围内的整型数值的个数是有限的，而浮点数却不是。</p>
<p>注意，<code>Integer、Short、Byte、Character、Long这几个类的valueOf方法的实现是类似的。</code></p>
<p>　　　 <code>Double、Float的valueOf方法的实现是类似的。</code></p>
<p>3.下面这段代码输出结果是什么：</p>
<pre><code>`public class Main {
    public static void main(String[] args) {

        Boolean i1 = false;
        Boolean i2 = false;
        Boolean i3 = true;
        Boolean i4 = true;

        System.out.println(i1==i2);
        System.out.println(i3==i4);
    }
}`
</code></pre><p>输出结果是：</p>
<pre><code>`true`
`true`
</code></pre><p>至于为什么是这个结果，同样地，看了Boolean类的源码也会一目了然。下面是Boolean的valueOf方法的具体实现：</p>
<pre><code>`public static Boolean valueOf(boolean b) {
    return (b ? TRUE : FALSE);
}`
</code></pre><p>而其中的 TRUE 和FALSE又是什么呢？在Boolean中定义了2个静态成员属性：</p>
<pre><code>`public static final Boolean TRUE = new Boolean(true);

/** 
 * The &lt;code&gt;Boolean&lt;/code&gt; object corresponding to the primitive 
 * value &lt;code&gt;false&lt;/code&gt;. 
 */
public static final Boolean FALSE = new Boolean(false);`
</code></pre><p>至此，大家应该明白了为何上面输出的结果都是true了。</p>
<p>4.谈谈Integer i = new Integer(xxx)和Integer i =xxx;这两种方式的区别。</p>
<p>　　当然，这个题目属于比较宽泛类型的。但是要点一定要答上，我总结一下主要有以下这两点区别：</p>
<p>1）第一种方式不会触发自动装箱的过程；而第二种方式会触发；</p>
<p>2）在执行效率和资源占用上的区别。第二种方式的执行效率和资源占用在一般性情况下要优于第一种情况（注意这并不是绝对的）。</p>
<p>5.下面程序的输出结果是什么？</p>
<pre><code>`public class Main {
    public static void main(String[] args) {

        Integer a = 1;
        Integer b = 2;
        Integer c = 3;
        Integer d = 3;
        Integer e = 321;
        Integer f = 321;
        Long g = 3L;
        Long h = 2L;

        System.out.println(c==d);
        System.out.println(e==f);
        System.out.println(c==(a+b));
        System.out.println(c.equals(a+b));
        System.out.println(g==(a+b));
        System.out.println(g.equals(a+b));
        System.out.println(g.equals(a+h));
    }
}`
</code></pre><p>先别看输出结果，读者自己想一下这段代码的输出结果是什么。这里面需要注意的是：<code>当 &quot;==&quot;运算符的两个操作数都是 包装器类型的引用，则是比较指向的是否是同一个对象，而如果其中有一个操作数是表达式（即包含算术运算）则比较的是数值（即会触发自动拆箱的过程）。</code>另外，对于包装器类型，equals方法并不会进行类型转换。明白了这2点之后，上面的输出结果便一目了然：</p>
<p>输出结果：</p>
<pre><code>`true
`false
`true
`true
`true
`false
`true`
</code></pre><p>第一个和第二个输出结果没有什么疑问。第三句由于  a+b包含了算术运算，因此会触发自动拆箱过程（会调用intValue方法），因此它们比较的是数值是否相等。而对于c.equals(a+b)会先触发自动拆箱过程，再触发自动装箱过程，也就是说a+b，会先各自调用intValue方法，得到了加法运算后的数值之后，便调用Integer.valueOf方法，再进行equals比较。同理对于后面的也是这样，不过要注意倒数第二个和最后一个输出的结果（如果数值是int类型的，装箱过程调用的是Integer.valueOf；如果是long类型的，装箱调用的Long.valueOf方法）。</p>
<p><br></p>
<p>【参考资料】</p>
<p><a href="http://www.cnblogs.com/dolphin0520/p/3780005.html" target="_blank" rel="external">http://www.cnblogs.com/dolphin0520/p/3780005.html</a></p>

      
    </div>

    
      

    

    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/11/06/java基础/拆箱和装箱/" data-id="cixpvfayy00135on6lvv2meic" class="article-share-link">
        <i class="fa fa-share"></i> Share
      </a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java基础/">java基础</a></li></ul>


    </footer>
  </div>
  
    
<ul id="article-nav" class="nav nav-pills nav-justified">
  
  <li role="presentation">
    <a href="/2016/11/06/java基础/String/" id="article-nav-older" class="article-nav-link-wrap">
      <i class="fa fa-chevron-left pull-left"></i>
      <span class="article-nav-link-title">探秘Java中的String、StringBuilder以及StringBuffer</span>
    </a>
  </li>
  
  
  <li role="presentation">
    <a href="/2016/11/06/java基础/对象和引用/" id="article-nav-newer" class="article-nav-link-wrap">
      <span class="article-nav-link-title">浅谈Java中的对象和引用</span>
      <i class="fa fa-chevron-right pull-right"></i>
    </a>
  </li>
  
</ul>


  
</article>


<section id="comments">
<!-- ��˵���ۿ� start -->
<div class="ds-thread" data-thread-key="post-java基础/拆箱和装箱" data-title="深入剖析Java中的装箱和拆箱" data-url="http://yoursite.com/2016/11/06/java基础/拆箱和装箱/"></div>
<!-- ��˵���ۿ� end -->
<!-- ��˵����JS���� start (һ����ҳֻ������һ��) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:'andone1cc'};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
     || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
  </script>
<!-- ��˵����JS���� end -->
</section>



        </div>
        <div class="col-sm-3 col-sm-offset-1 blog-sidebar">
          
  <div class="sidebar-module sidebar-module-inset">
  <h4>About</h4>
  <p><em>青岛大学   计算机</em><br /> Algorithm JAVA C/C++ Python <br />有些事不是看到希望了才去坚持,而是坚持了才会看到希望..</p>

</div>


  
  <div class="sidebar-module">
    <h4>Categories</h4>
    <ul class="sidebar-module-list"><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/categories/Algorithm/">Algorithm</a><span class="sidebar-module-list-count">5</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/categories/JAVA/">JAVA</a><span class="sidebar-module-list-count">16</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/categories/LINUX/">LINUX</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/categories/java高级/">java高级</a><span class="sidebar-module-list-count">9</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/categories/设计模式/">设计模式</a><span class="sidebar-module-list-count">2</span></li></ul>
  </div>



  
  <div class="sidebar-module">
    <h4>Tags</h4>
    <ul class="sidebar-module-list"><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/JVM的核心机制/">JVM的核心机制</a><span class="sidebar-module-list-count">2</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/SSH/">SSH</a><span class="sidebar-module-list-count">6</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/String/">String</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/ajax/">ajax</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/java基础/">java基础</a><span class="sidebar-module-list-count">13</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/linux/">linux</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/二叉树/">二叉树</a><span class="sidebar-module-list-count">5</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/框架/">框架</a><span class="sidebar-module-list-count">2</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/设计模式/">设计模式</a><span class="sidebar-module-list-count">2</span></li></ul>
  </div>



  
  <div class="sidebar-module">
    <h4>Archives</h4>
    <ul class="sidebar-module-list"><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2017/01/">一月 2017</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2016/12/">十二月 2016</a><span class="sidebar-module-list-count">2</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2016/11/">十一月 2016</a><span class="sidebar-module-list-count">29</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2016/10/">十月 2016</a><span class="sidebar-module-list-count">1</span></li></ul>
  </div>



  
  <div class="sidebar-module">
    <h4>Recents</h4>
    <ul class="sidebar-module-list">
      
        <li>
          <a href="/2017/01/09/linux/vmvare网络/">VMware虚拟机提供的桥接、NAT和主机模式的区别</a>
        </li>
      
        <li>
          <a href="/2016/12/13/java高级/hibernate和mybatis总结/">Hibernate和MyBatis学习总结</a>
        </li>
      
        <li>
          <a href="/2016/12/07/java高级/struts2和springmvc总结/">struts2和springmvc学习总结</a>
        </li>
      
        <li>
          <a href="/2016/11/29/java基础/Hashmap排序/">如何对HashMap按键值排序</a>
        </li>
      
        <li>
          <a href="/2016/11/28/java高级/ajax/">原生和jQuery的ajax</a>
        </li>
      
    </ul>
  </div>



        </div>
    </div>
  </div>
  <footer class="blog-footer">
  <div class="container">
    <div id="footer-info" class="inner">
      &copy; 2017 QDU-scc<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

  

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js" integrity="sha384-8gBf6Y4YYq7Jx97PIqmTwLPin4hxIzQw5aDmUg/DDhul9fFpbbLcLh3nTIIDJKhx" crossorigin="anonymous"></script>

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>



<script src="/js/script.js"></script>

</body>
</html>
